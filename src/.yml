----
【变量更新】
在所有文本的最后，进行变量更新。
以下是故事中需要追踪的关键变量，当前状态以这些变量的值为准。
<status_current_variables>
日期:{{get_message_variable::stat_data.date}}
时间:{{get_message_variable::stat_data.time}}
<user>当前位置:{{get_message_variable::stat_data.location}}
<user>性别:{{get_message_variable::stat_data.gender}}
<user>种族:{{get_message_variable::stat_data.race}}
<user>年龄:{{get_message_variable::stat_data.age}}
<user>经验:{{get_message_variable::stat_data.exp}}
<user>基础属性:{{get_message_variable::stat_data.base_attributes}}
<user>当前属性:{{get_message_variable::stat_data.current_attributes}}
<user>装备:{{get_message_variable::stat_data.equipment}}
<user>背包:{{get_message_variable::stat_data.inventory}}
关系列表:{{get_message_variable::stat_data.relationships}}
敌人列表:{{get_message_variable::stat_data.enemies}}
</status_current_variables>
严格按照以下规则和格式进行输出，并确定每一个变量是否需要更新，不要遗漏：
rule:
  description:
    - The provided example is for format demonstration only. Do not copy the values or specific actions from the example into your actual updates.
    - You should output the update analysis in the end of the next response, following the variables list defined in <status_current_variables> section which will be provided by the previous turn.
    - In context, variable updates are omitted by the system so they are not shown to you, but you should still add it.
    - There are 4 commands can be used to adjust the data: `_.set`, `_.assign`, `_.remove` and `_.add`.
    - to set a certain value, use `_.set`, it supports 2 or 3 input args.
    - to insert something into an array or object, use `_.assign`, it supports 2 or 3 input args.
    - to delete something from an object/array, use `_.remove`, it supports 1 or 2 input args.
    - If you need to assign or remove multiple values, use `_.assign` or `_.remove` multiple times, not in a single command.
    - to add a delta to a number, use `_.add`, it only supports 2 input args, and only supports modifications to numbers.
  analysis:
    - You must rethink what variables are defined in the previous <status_current_variables> property, and analyze how to update each of them accordingly.
    - For counting variables, change it when the corresponding event occur but don't change it any more during the same event.
    - When a numerical variable changes, check if it crosses any stage threshold and update to the corresponding stage.
format: |-
  <UpdateVariable>
      <Analysis>$(IN ENGLISH)
          - Analyze the current situation and how it affects each variable.
          - List every variable from `<status_current_variables>`.
          - For each variable, decide if it needs an update based on its description and the story progress.
          ...
      </Analysis>
      _.set('${path}', ${old_value}, ${new_value});//${reason}
      _.add('${path}', ${delta});//${reason}
      _.assign('${path}', ${key_or_index}?, ${value});//${reason}
      _.remove('${path}', ${key_or_index_or_value}?);//${reason}
  </UpdateVariable>
 <UpdateVariable>
    <Analysis>
      - date[0]: No
      - time[0]: Yes
      - location[0]: No
      - random_event[0]: No
      - base_attributes[0]: No
      - current_attributes[0]: No
      - equipment.weapon: No
      - equipment.armor: No
      - equipment.accessory: No
      - inventory.weapons[0]: Yes
      - inventory.armors[0]: No
      - inventory.accessories[0]: No
      - inventory.others[0]: Yes
      - relationships: Yes
    </Analysis>
    _.insert('inventory.weapons', {'name':'锈蚀的匕首', 'description':'一把看起来很旧的匕首，但刃口依然锋利。', 'attributes_bonus':{'agility': 1}});//<user>在战利品中找到了一把匕首
    _.remove('inventory[0].others[0]', {'name':'劣质治疗药水', 'description':'能恢复少量生命值，但味道很差。', 'quantity':1});//<user>在战斗中使用了治疗药水
    _.insert('relationships', '黑川凛', {gender':'女','race':'人族','age':'未知','background':'背景神秘的阴阳师','personality':'外冷内热','outfit':'黑色和服','thoughts':'这个新人很有潜力，值得观察。','relationship':'初识','others':'无','events':[[]],'attributes':{'strength':30,'agility':35,'intelligence':40,'constitution':25,'charisma':28,'willpower':35,'luck':20},'affinity':[15, '对<user>的好感度,范围[-200,200]']});//<user>与新角色“黑川凛”相遇，并因其战斗表现获得了一些好感
  </UpdateVariable>