<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>变量修正脚本测试</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin-bottom: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .section h3 {
        margin-top: 0;
        color: #333;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      .log {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 10px;
        max-height: 300px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 12px;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
      }
      .status.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .status.info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
    </style>
  <script type="module">var __webpack_modules__ = {
  "./src/mvu更新脚本/index.ts": 
  /*!******************************!*\
  !*** ./src/mvu更新脚本/index.ts ***!
  \******************************/ () => {
    eval("{\n/**\n * 变量修正脚本\n * 用于检测和修正AI不正确修改变量的问题\n *\n * 问题场景：\n * - 发送给AI的stat_data中经验值为0\n * - AI知道经验值为0，但在返回时将其改为50\n * - 然后对50使用_.add函数增加，display_data显示为50->55\n * - 实际应该是0->5\n *\n * 解决方案：\n * - 保存发送给AI时的原始stat_data\n * - 检查display_data中的\"前一个数值\"是否与原始值相同\n * - 如果不同，则将display_data中的值替换为原始值\n */\n// 保存发送给AI时的原始stat_data\nlet originalStatData = {};\nlet isMessageSending = false;\n// 获取用户键名\nconst userKey = substitudeMacros('<user>');\n/**\n * 保存原始stat_data\n * 在发送消息给AI之前调用\n */\nfunction saveOriginalStatData() {\n    try {\n        const variables = getVariables({ type: 'chat' });\n        if (variables && variables.stat_data) {\n            // 深度复制原始数据，避免引用问题\n            originalStatData = _.cloneDeep(variables.stat_data);\n            console.log('已保存原始stat_data:', originalStatData);\n        }\n    }\n    catch (error) {\n        console.error('保存原始stat_data时出错:', error);\n    }\n}\n/**\n * 检查并修正display_data中的变量\n * 在接收AI回复后调用\n */\nfunction correctDisplayData() {\n    try {\n        const variables = getVariables({ type: 'chat' });\n        if (!variables || !variables.display_data || !originalStatData) {\n            return;\n        }\n        const displayData = variables.display_data;\n        let correctedCount = 0;\n        // 遍历display_data，检查每个变量\n        for (const [path, value] of Object.entries(displayData)) {\n            if (Array.isArray(value) && value.length > 0 && _.has(originalStatData, path)) {\n                const originalValue = _.get(originalStatData, path);\n                const displayValue = value[0]; // display_data中的\"前一个数值\"\n                // 检查值是否被AI修改\n                if (displayValue !== originalValue) {\n                    // AI修改了原始值，需要修正\n                    const oldValue = value[0];\n                    value[0] = originalValue;\n                    correctedCount++;\n                    console.warn(`修正变量 ${path}: ${oldValue} -> ${originalValue}`);\n                    // 记录修正日志\n                    logCorrection(path, oldValue, originalValue);\n                }\n            }\n        }\n        if (correctedCount > 0) {\n            console.log(`共修正了 ${correctedCount} 个变量`);\n        }\n    }\n    catch (error) {\n        console.error('修正display_data时出错:', error);\n    }\n}\n/**\n * 记录变量修正日志\n */\nfunction logCorrection(path, oldValue, newValue) {\n    const timestamp = new Date().toISOString();\n    const logEntry = {\n        timestamp,\n        path,\n        oldValue,\n        newValue,\n        userKey,\n    };\n    console.log('变量修正日志:', logEntry);\n}\n/**\n * 检查变量是否被AI修改\n * @param path 变量路径\n * @param currentValue 当前值\n * @returns 是否被修改\n */\nfunction isVariableModified(path, currentValue) {\n    if (!originalStatData || !_.has(originalStatData, path)) {\n        return false;\n    }\n    const originalValue = _.get(originalStatData, path);\n    return currentValue !== originalValue;\n}\n/**\n * 获取变量的原始值\n * @param path 变量路径\n * @returns 原始值\n */\nfunction getOriginalValue(path) {\n    if (!originalStatData || !_.has(originalStatData, path)) {\n        return null;\n    }\n    return _.get(originalStatData, path);\n}\n/**\n * 重置原始数据\n * 在需要重新开始跟踪时调用\n */\nfunction resetOriginalData() {\n    originalStatData = {};\n    console.log('已重置原始数据');\n}\n/**\n * 获取修正统计信息\n */\nfunction getCorrectionStats() {\n    const variables = getVariables({ type: 'chat' });\n    if (!variables || !variables.display_data || !originalStatData) {\n        return { total: 0, corrected: 0, details: [] };\n    }\n    const displayData = variables.display_data;\n    const details = [];\n    let correctedCount = 0;\n    for (const [path, value] of Object.entries(displayData)) {\n        if (Array.isArray(value) && value.length > 0 && _.has(originalStatData, path)) {\n            const originalValue = _.get(originalStatData, path);\n            const currentValue = value[0];\n            const corrected = currentValue !== originalValue;\n            details.push({\n                path,\n                original: originalValue,\n                current: currentValue,\n                corrected,\n            });\n            if (corrected) {\n                correctedCount++;\n            }\n        }\n    }\n    return {\n        total: details.length,\n        corrected: correctedCount,\n        details,\n    };\n}\n// 事件监听函数\n/**\n * 消息发送前事件处理\n * 保存原始stat_data\n */\nfunction onMessageSending() {\n    isMessageSending = true;\n    saveOriginalStatData();\n    console.log('消息发送前：已保存原始stat_data');\n}\n/**\n * 消息接收后事件处理\n * 检查并修正display_data\n */\nfunction onMessageReceived() {\n    if (isMessageSending) {\n        // 延迟执行，确保display_data已更新\n        setTimeout(() => {\n            correctDisplayData();\n            isMessageSending = false;\n            console.log('消息接收后：已检查并修正display_data');\n        }, 100);\n    }\n}\n/**\n * 变量更新事件处理\n * 在变量更新过程中进行额外检查\n */\nfunction onVariableUpdateStarted(variables, out_is_updated) {\n    // 如果正在发送消息，不进行额外处理\n    if (isMessageSending) {\n        return;\n    }\n    // 可以在这里添加额外的变量保护逻辑\n    console.log('变量更新开始');\n}\nfunction onVariableUpdated(stat_data, path, oldValue, newValue) {\n    // 如果正在发送消息，不进行额外处理\n    if (isMessageSending) {\n        return;\n    }\n    // 检查变量是否被AI修改\n    if (isVariableModified(path, newValue)) {\n        const originalValue = getOriginalValue(path);\n        console.warn(`检测到变量被修改: ${path}`, {\n            original: originalValue,\n            old: oldValue,\n            new: newValue,\n        });\n    }\n}\nfunction onVariableUpdateEnded(variables, out_is_updated) {\n    // 如果正在发送消息，不进行额外处理\n    if (isMessageSending) {\n        return;\n    }\n    console.log('变量更新结束');\n}\n// 注册事件监听器\neventOn('mag_variable_update_started', onVariableUpdateStarted);\neventOn('mag_variable_updated', onVariableUpdated);\neventOn('mag_variable_update_ended', onVariableUpdateEnded);\n// 监听消息发送和接收事件\n// 注意：这些事件名称可能需要根据实际情况调整\neventOn('message_sending', onMessageSending);\neventOn('message_received', onMessageReceived);\n// 导出函数供外部调用\nwindow.variableCorrection = {\n    saveOriginalStatData,\n    correctDisplayData,\n    isVariableModified,\n    getOriginalValue,\n    resetOriginalData,\n    getCorrectionStats,\n};\nconsole.log('变量修正脚本已加载');\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFJLEVBQUUsRUFBRTtZQUNoQyxRQUFRLEVBQUUsYUFBYTtZQUN2QixHQUFHLEVBQUUsUUFBUTtZQUNiLEdBQUcsRUFBRSxRQUFRO1NBQ2QsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUM7QUFFRCxTQUFTLHFCQUFxQixDQUFDLFNBQWMsRUFBRSxjQUF1QjtJQUNwRSxtQkFBbUI7SUFDbkIsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3JCLE9BQU87SUFDVCxDQUFDO0lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN4QixDQUFDO0FBRUQsVUFBVTtBQUNWLE9BQU8sQ0FBQyw2QkFBNkIsRUFBRSx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2hFLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO0FBQ25ELE9BQU8sQ0FBQywyQkFBMkIsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO0FBRTVELGNBQWM7QUFDZCx3QkFBd0I7QUFDeEIsT0FBTyxDQUFDLGlCQUFpQixFQUFFLGdCQUFnQixDQUFDLENBQUM7QUFDN0MsT0FBTyxDQUFDLGtCQUFrQixFQUFFLGlCQUFpQixDQUFDLENBQUM7QUFFL0MsWUFBWTtBQUNYLE1BQWMsQ0FBQyxrQkFBa0IsR0FBRztJQUNuQyxvQkFBb0I7SUFDcEIsa0JBQWtCO0lBQ2xCLGtCQUFrQjtJQUNsQixnQkFBZ0I7SUFDaEIsaUJBQWlCO0lBQ2pCLGtCQUFrQjtDQUNuQixDQUFDO0FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvLi9zcmMvbXZ15pu05paw6ISa5pysL2luZGV4LnRzPyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog5Y+Y6YeP5L+u5q2j6ISa5pysXHJcbiAqIOeUqOS6juajgOa1i+WSjOS/ruato0FJ5LiN5q2j56Gu5L+u5pS55Y+Y6YeP55qE6Zeu6aKYXHJcbiAqXHJcbiAqIOmXrumimOWcuuaZr++8mlxyXG4gKiAtIOWPkemAgee7mUFJ55qEc3RhdF9kYXRh5Lit57uP6aqM5YC85Li6MFxyXG4gKiAtIEFJ55+l6YGT57uP6aqM5YC85Li6MO+8jOS9huWcqOi/lOWbnuaXtuWwhuWFtuaUueS4ujUwXHJcbiAqIC0g54S25ZCO5a+5NTDkvb/nlKhfLmFkZOWHveaVsOWinuWKoO+8jGRpc3BsYXlfZGF0YeaYvuekuuS4ujUwLT41NVxyXG4gKiAtIOWunumZheW6lOivpeaYrzAtPjVcclxuICpcclxuICog6Kej5Yaz5pa55qGI77yaXHJcbiAqIC0g5L+d5a2Y5Y+R6YCB57uZQUnml7bnmoTljp/lp4tzdGF0X2RhdGFcclxuICogLSDmo4Dmn6VkaXNwbGF5X2RhdGHkuK3nmoRcIuWJjeS4gOS4quaVsOWAvFwi5piv5ZCm5LiO5Y6f5aeL5YC855u45ZCMXHJcbiAqIC0g5aaC5p6c5LiN5ZCM77yM5YiZ5bCGZGlzcGxheV9kYXRh5Lit55qE5YC85pu/5o2i5Li65Y6f5aeL5YC8XHJcbiAqL1xyXG5cclxuLy8g5L+d5a2Y5Y+R6YCB57uZQUnml7bnmoTljp/lp4tzdGF0X2RhdGFcclxubGV0IG9yaWdpbmFsU3RhdERhdGE6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcclxubGV0IGlzTWVzc2FnZVNlbmRpbmcgPSBmYWxzZTtcclxuXHJcbi8vIOiOt+WPlueUqOaIt+mUruWQjVxyXG5jb25zdCB1c2VyS2V5ID0gc3Vic3RpdHVkZU1hY3JvcygnPHVzZXI+Jyk7XHJcblxyXG4vKipcclxuICog5L+d5a2Y5Y6f5aeLc3RhdF9kYXRhXHJcbiAqIOWcqOWPkemAgea2iOaBr+e7mUFJ5LmL5YmN6LCD55SoXHJcbiAqL1xyXG5mdW5jdGlvbiBzYXZlT3JpZ2luYWxTdGF0RGF0YSgpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdmFyaWFibGVzID0gZ2V0VmFyaWFibGVzKHsgdHlwZTogJ2NoYXQnIH0pO1xyXG4gICAgaWYgKHZhcmlhYmxlcyAmJiB2YXJpYWJsZXMuc3RhdF9kYXRhKSB7XHJcbiAgICAgIC8vIOa3seW6puWkjeWItuWOn+Wni+aVsOaNru+8jOmBv+WFjeW8leeUqOmXrumimFxyXG4gICAgICBvcmlnaW5hbFN0YXREYXRhID0gXy5jbG9uZURlZXAodmFyaWFibGVzLnN0YXRfZGF0YSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCflt7Lkv53lrZjljp/lp4tzdGF0X2RhdGE6Jywgb3JpZ2luYWxTdGF0RGF0YSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+S/neWtmOWOn+Wni3N0YXRfZGF0YeaXtuWHuumUmTonLCBlcnJvcik7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog5qOA5p+l5bm25L+u5q2jZGlzcGxheV9kYXRh5Lit55qE5Y+Y6YePXHJcbiAqIOWcqOaOpeaUtkFJ5Zue5aSN5ZCO6LCD55SoXHJcbiAqL1xyXG5mdW5jdGlvbiBjb3JyZWN0RGlzcGxheURhdGEoKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHZhcmlhYmxlcyA9IGdldFZhcmlhYmxlcyh7IHR5cGU6ICdjaGF0JyB9KTtcclxuICAgIGlmICghdmFyaWFibGVzIHx8ICF2YXJpYWJsZXMuZGlzcGxheV9kYXRhIHx8ICFvcmlnaW5hbFN0YXREYXRhKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBkaXNwbGF5RGF0YSA9IHZhcmlhYmxlcy5kaXNwbGF5X2RhdGE7XHJcbiAgICBsZXQgY29ycmVjdGVkQ291bnQgPSAwO1xyXG5cclxuICAgIC8vIOmBjeWOhmRpc3BsYXlfZGF0Ye+8jOajgOafpeavj+S4quWPmOmHj1xyXG4gICAgZm9yIChjb25zdCBbcGF0aCwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRpc3BsYXlEYXRhKSkge1xyXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID4gMCAmJiBfLmhhcyhvcmlnaW5hbFN0YXREYXRhLCBwYXRoKSkge1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSBfLmdldChvcmlnaW5hbFN0YXREYXRhLCBwYXRoKTtcclxuICAgICAgICBjb25zdCBkaXNwbGF5VmFsdWUgPSB2YWx1ZVswXTsgLy8gZGlzcGxheV9kYXRh5Lit55qEXCLliY3kuIDkuKrmlbDlgLxcIlxyXG5cclxuICAgICAgICAvLyDmo4Dmn6XlgLzmmK/lkKbooqtBSeS/ruaUuVxyXG4gICAgICAgIGlmIChkaXNwbGF5VmFsdWUgIT09IG9yaWdpbmFsVmFsdWUpIHtcclxuICAgICAgICAgIC8vIEFJ5L+u5pS55LqG5Y6f5aeL5YC877yM6ZyA6KaB5L+u5q2jXHJcbiAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHZhbHVlWzBdO1xyXG4gICAgICAgICAgdmFsdWVbMF0gPSBvcmlnaW5hbFZhbHVlO1xyXG4gICAgICAgICAgY29ycmVjdGVkQ291bnQrKztcclxuXHJcbiAgICAgICAgICBjb25zb2xlLndhcm4oYOS/ruato+WPmOmHjyAke3BhdGh9OiAke29sZFZhbHVlfSAtPiAke29yaWdpbmFsVmFsdWV9YCk7XHJcblxyXG4gICAgICAgICAgLy8g6K6w5b2V5L+u5q2j5pel5b+XXHJcbiAgICAgICAgICBsb2dDb3JyZWN0aW9uKHBhdGgsIG9sZFZhbHVlLCBvcmlnaW5hbFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoY29ycmVjdGVkQ291bnQgPiAwKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDlhbHkv67mraPkuoYgJHtjb3JyZWN0ZWRDb3VudH0g5Liq5Y+Y6YePYCk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ+S/ruato2Rpc3BsYXlfZGF0YeaXtuWHuumUmTonLCBlcnJvcik7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICog6K6w5b2V5Y+Y6YeP5L+u5q2j5pel5b+XXHJcbiAqL1xyXG5mdW5jdGlvbiBsb2dDb3JyZWN0aW9uKHBhdGg6IHN0cmluZywgb2xkVmFsdWU6IGFueSwgbmV3VmFsdWU6IGFueSkge1xyXG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICBjb25zdCBsb2dFbnRyeSA9IHtcclxuICAgIHRpbWVzdGFtcCxcclxuICAgIHBhdGgsXHJcbiAgICBvbGRWYWx1ZSxcclxuICAgIG5ld1ZhbHVlLFxyXG4gICAgdXNlcktleSxcclxuICB9O1xyXG5cclxuICBjb25zb2xlLmxvZygn5Y+Y6YeP5L+u5q2j5pel5b+XOicsIGxvZ0VudHJ5KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOajgOafpeWPmOmHj+aYr+WQpuiiq0FJ5L+u5pS5XHJcbiAqIEBwYXJhbSBwYXRoIOWPmOmHj+i3r+W+hFxyXG4gKiBAcGFyYW0gY3VycmVudFZhbHVlIOW9k+WJjeWAvFxyXG4gKiBAcmV0dXJucyDmmK/lkKbooqvkv67mlLlcclxuICovXHJcbmZ1bmN0aW9uIGlzVmFyaWFibGVNb2RpZmllZChwYXRoOiBzdHJpbmcsIGN1cnJlbnRWYWx1ZTogYW55KTogYm9vbGVhbiB7XHJcbiAgaWYgKCFvcmlnaW5hbFN0YXREYXRhIHx8ICFfLmhhcyhvcmlnaW5hbFN0YXREYXRhLCBwYXRoKSkge1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgY29uc3Qgb3JpZ2luYWxWYWx1ZSA9IF8uZ2V0KG9yaWdpbmFsU3RhdERhdGEsIHBhdGgpO1xyXG4gIHJldHVybiBjdXJyZW50VmFsdWUgIT09IG9yaWdpbmFsVmFsdWU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDojrflj5blj5jph4/nmoTljp/lp4vlgLxcclxuICogQHBhcmFtIHBhdGgg5Y+Y6YeP6Lev5b6EXHJcbiAqIEByZXR1cm5zIOWOn+Wni+WAvFxyXG4gKi9cclxuZnVuY3Rpb24gZ2V0T3JpZ2luYWxWYWx1ZShwYXRoOiBzdHJpbmcpOiBhbnkge1xyXG4gIGlmICghb3JpZ2luYWxTdGF0RGF0YSB8fCAhXy5oYXMob3JpZ2luYWxTdGF0RGF0YSwgcGF0aCkpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIF8uZ2V0KG9yaWdpbmFsU3RhdERhdGEsIHBhdGgpO1xyXG59XHJcblxyXG4vKipcclxuICog6YeN572u5Y6f5aeL5pWw5o2uXHJcbiAqIOWcqOmcgOimgemHjeaWsOW8gOWni+i3n+i4quaXtuiwg+eUqFxyXG4gKi9cclxuZnVuY3Rpb24gcmVzZXRPcmlnaW5hbERhdGEoKSB7XHJcbiAgb3JpZ2luYWxTdGF0RGF0YSA9IHt9O1xyXG4gIGNvbnNvbGUubG9nKCflt7Lph43nva7ljp/lp4vmlbDmja4nKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOiOt+WPluS/ruato+e7n+iuoeS/oeaBr1xyXG4gKi9cclxuZnVuY3Rpb24gZ2V0Q29ycmVjdGlvblN0YXRzKCkge1xyXG4gIGNvbnN0IHZhcmlhYmxlcyA9IGdldFZhcmlhYmxlcyh7IHR5cGU6ICdjaGF0JyB9KTtcclxuICBpZiAoIXZhcmlhYmxlcyB8fCAhdmFyaWFibGVzLmRpc3BsYXlfZGF0YSB8fCAhb3JpZ2luYWxTdGF0RGF0YSkge1xyXG4gICAgcmV0dXJuIHsgdG90YWw6IDAsIGNvcnJlY3RlZDogMCwgZGV0YWlsczogW10gfTtcclxuICB9XHJcblxyXG4gIGNvbnN0IGRpc3BsYXlEYXRhID0gdmFyaWFibGVzLmRpc3BsYXlfZGF0YTtcclxuICBjb25zdCBkZXRhaWxzOiBBcnJheTx7IHBhdGg6IHN0cmluZzsgb3JpZ2luYWw6IGFueTsgY3VycmVudDogYW55OyBjb3JyZWN0ZWQ6IGJvb2xlYW4gfT4gPSBbXTtcclxuICBsZXQgY29ycmVjdGVkQ291bnQgPSAwO1xyXG5cclxuICBmb3IgKGNvbnN0IFtwYXRoLCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZGlzcGxheURhdGEpKSB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID4gMCAmJiBfLmhhcyhvcmlnaW5hbFN0YXREYXRhLCBwYXRoKSkge1xyXG4gICAgICBjb25zdCBvcmlnaW5hbFZhbHVlID0gXy5nZXQob3JpZ2luYWxTdGF0RGF0YSwgcGF0aCk7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IHZhbHVlWzBdO1xyXG4gICAgICBjb25zdCBjb3JyZWN0ZWQgPSBjdXJyZW50VmFsdWUgIT09IG9yaWdpbmFsVmFsdWU7XHJcblxyXG4gICAgICBkZXRhaWxzLnB1c2goe1xyXG4gICAgICAgIHBhdGgsXHJcbiAgICAgICAgb3JpZ2luYWw6IG9yaWdpbmFsVmFsdWUsXHJcbiAgICAgICAgY3VycmVudDogY3VycmVudFZhbHVlLFxyXG4gICAgICAgIGNvcnJlY3RlZCxcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoY29ycmVjdGVkKSB7XHJcbiAgICAgICAgY29ycmVjdGVkQ291bnQrKztcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIHRvdGFsOiBkZXRhaWxzLmxlbmd0aCxcclxuICAgIGNvcnJlY3RlZDogY29ycmVjdGVkQ291bnQsXHJcbiAgICBkZXRhaWxzLFxyXG4gIH07XHJcbn1cclxuXHJcbi8vIOS6i+S7tuebkeWQrOWHveaVsFxyXG5cclxuLyoqXHJcbiAqIOa2iOaBr+WPkemAgeWJjeS6i+S7tuWkhOeQhlxyXG4gKiDkv53lrZjljp/lp4tzdGF0X2RhdGFcclxuICovXHJcbmZ1bmN0aW9uIG9uTWVzc2FnZVNlbmRpbmcoKSB7XHJcbiAgaXNNZXNzYWdlU2VuZGluZyA9IHRydWU7XHJcbiAgc2F2ZU9yaWdpbmFsU3RhdERhdGEoKTtcclxuICBjb25zb2xlLmxvZygn5raI5oGv5Y+R6YCB5YmN77ya5bey5L+d5a2Y5Y6f5aeLc3RhdF9kYXRhJyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDmtojmga/mjqXmlLblkI7kuovku7blpITnkIZcclxuICog5qOA5p+l5bm25L+u5q2jZGlzcGxheV9kYXRhXHJcbiAqL1xyXG5mdW5jdGlvbiBvbk1lc3NhZ2VSZWNlaXZlZCgpIHtcclxuICBpZiAoaXNNZXNzYWdlU2VuZGluZykge1xyXG4gICAgLy8g5bu26L+f5omn6KGM77yM56Gu5L+dZGlzcGxheV9kYXRh5bey5pu05pawXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgY29ycmVjdERpc3BsYXlEYXRhKCk7XHJcbiAgICAgIGlzTWVzc2FnZVNlbmRpbmcgPSBmYWxzZTtcclxuICAgICAgY29uc29sZS5sb2coJ+a2iOaBr+aOpeaUtuWQju+8muW3suajgOafpeW5tuS/ruato2Rpc3BsYXlfZGF0YScpO1xyXG4gICAgfSwgMTAwKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDlj5jph4/mm7TmlrDkuovku7blpITnkIZcclxuICog5Zyo5Y+Y6YeP5pu05paw6L+H56iL5Lit6L+b6KGM6aKd5aSW5qOA5p+lXHJcbiAqL1xyXG5mdW5jdGlvbiBvblZhcmlhYmxlVXBkYXRlU3RhcnRlZCh2YXJpYWJsZXM6IGFueSwgb3V0X2lzX3VwZGF0ZWQ6IGJvb2xlYW4pIHtcclxuICAvLyDlpoLmnpzmraPlnKjlj5HpgIHmtojmga/vvIzkuI3ov5vooYzpop3lpJblpITnkIZcclxuICBpZiAoaXNNZXNzYWdlU2VuZGluZykge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgLy8g5Y+v5Lul5Zyo6L+Z6YeM5re75Yqg6aKd5aSW55qE5Y+Y6YeP5L+d5oqk6YC76L6RXHJcbiAgY29uc29sZS5sb2coJ+WPmOmHj+abtOaWsOW8gOWniycpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBvblZhcmlhYmxlVXBkYXRlZChzdGF0X2RhdGE6IGFueSwgcGF0aDogc3RyaW5nLCBvbGRWYWx1ZTogYW55LCBuZXdWYWx1ZTogYW55KSB7XHJcbiAgLy8g5aaC5p6c5q2j5Zyo5Y+R6YCB5raI5oGv77yM5LiN6L+b6KGM6aKd5aSW5aSE55CGXHJcbiAgaWYgKGlzTWVzc2FnZVNlbmRpbmcpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIC8vIOajgOafpeWPmOmHj+aYr+WQpuiiq0FJ5L+u5pS5XHJcbiAgaWYgKGlzVmFyaWFibGVNb2RpZmllZChwYXRoLCBuZXdWYWx1ZSkpIHtcclxuICAgIGNvbnN0IG9yaWdpbmFsVmFsdWUgPSBnZXRPcmlnaW5hbFZhbHVlKHBhdGgpO1xyXG4gICAgY29uc29sZS53YXJuKGDmo4DmtYvliLDlj5jph4/ooqvkv67mlLk6ICR7cGF0aH1gLCB7XHJcbiAgICAgIG9yaWdpbmFsOiBvcmlnaW5hbFZhbHVlLFxyXG4gICAgICBvbGQ6IG9sZFZhbHVlLFxyXG4gICAgICBuZXc6IG5ld1ZhbHVlLFxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBvblZhcmlhYmxlVXBkYXRlRW5kZWQodmFyaWFibGVzOiBhbnksIG91dF9pc191cGRhdGVkOiBib29sZWFuKSB7XHJcbiAgLy8g5aaC5p6c5q2j5Zyo5Y+R6YCB5raI5oGv77yM5LiN6L+b6KGM6aKd5aSW5aSE55CGXHJcbiAgaWYgKGlzTWVzc2FnZVNlbmRpbmcpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKCflj5jph4/mm7TmlrDnu5PmnZ8nKTtcclxufVxyXG5cclxuLy8g5rOo5YaM5LqL5Lu255uR5ZCs5ZmoXHJcbmV2ZW50T24oJ21hZ192YXJpYWJsZV91cGRhdGVfc3RhcnRlZCcsIG9uVmFyaWFibGVVcGRhdGVTdGFydGVkKTtcclxuZXZlbnRPbignbWFnX3ZhcmlhYmxlX3VwZGF0ZWQnLCBvblZhcmlhYmxlVXBkYXRlZCk7XHJcbmV2ZW50T24oJ21hZ192YXJpYWJsZV91cGRhdGVfZW5kZWQnLCBvblZhcmlhYmxlVXBkYXRlRW5kZWQpO1xyXG5cclxuLy8g55uR5ZCs5raI5oGv5Y+R6YCB5ZKM5o6l5pS25LqL5Lu2XHJcbi8vIOazqOaEj++8mui/meS6m+S6i+S7tuWQjeensOWPr+iDvemcgOimgeagueaNruWunumZheaDheWGteiwg+aVtFxyXG5ldmVudE9uKCdtZXNzYWdlX3NlbmRpbmcnLCBvbk1lc3NhZ2VTZW5kaW5nKTtcclxuZXZlbnRPbignbWVzc2FnZV9yZWNlaXZlZCcsIG9uTWVzc2FnZVJlY2VpdmVkKTtcclxuXHJcbi8vIOWvvOWHuuWHveaVsOS+m+WklumDqOiwg+eUqFxyXG4od2luZG93IGFzIGFueSkudmFyaWFibGVDb3JyZWN0aW9uID0ge1xyXG4gIHNhdmVPcmlnaW5hbFN0YXREYXRhLFxyXG4gIGNvcnJlY3REaXNwbGF5RGF0YSxcclxuICBpc1ZhcmlhYmxlTW9kaWZpZWQsXHJcbiAgZ2V0T3JpZ2luYWxWYWx1ZSxcclxuICByZXNldE9yaWdpbmFsRGF0YSxcclxuICBnZXRDb3JyZWN0aW9uU3RhdHMsXHJcbn07XHJcblxyXG5jb25zb2xlLmxvZygn5Y+Y6YeP5L+u5q2j6ISa5pys5bey5Yqg6L29Jyk7XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/mvu更新脚本/index.ts\n\n}");
  }
};

var __webpack_exports__ = {};

__webpack_modules__["./src/mvu更新脚本/index.ts"]();</script></head>
  <body>
    <div class="container">
      <h1>变量修正脚本测试界面</h1>

      <div class="section">
        <h3>脚本状态</h3>
        <div id="scriptStatus" class="status info">脚本加载中...</div>
      </div>

      <div class="section">
        <h3>基本操作</h3>
        <button onclick="saveOriginalData()">保存原始数据</button>
        <button onclick="correctDisplayData()">修正显示数据</button>
        <button onclick="resetData()">重置数据</button>
        <button onclick="getStats()">获取统计信息</button>
      </div>

      <div class="section">
        <h3>测试功能</h3>
        <button onclick="testVariableModification()">测试变量修改检测</button>
        <button onclick="simulateMessageSending()">模拟消息发送</button>
        <button onclick="simulateMessageReceived()">模拟消息接收</button>
      </div>

      <div class="section">
        <h3>日志输出</h3>
        <div id="logOutput" class="log"></div>
        <button onclick="clearLog()">清空日志</button>
      </div>

      <div class="section">
        <h3>统计信息</h3>
        <div id="statsOutput" class="log"></div>
      </div>
    </div>

    <script>
      // 重写console.log来捕获日志
      const originalLog = console.log;
      const originalWarn = console.warn;
      const originalError = console.error;

      function addToLog(message, type = 'log') {
        const logOutput = document.getElementById('logOutput');
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
        logEntry.textContent = `[${timestamp}] ${message}`;
        logOutput.appendChild(logEntry);
        logOutput.scrollTop = logOutput.scrollHeight;
      }

      console.log = function (...args) {
        originalLog.apply(console, args);
        addToLog(args.join(' '), 'log');
      };

      console.warn = function (...args) {
        originalWarn.apply(console, args);
        addToLog(args.join(' '), 'warn');
      };

      console.error = function (...args) {
        originalError.apply(console, args);
        addToLog(args.join(' '), 'error');
      };

      // 页面加载完成后检查脚本状态
      window.addEventListener('load', function () {
        setTimeout(() => {
          if (window.variableCorrection) {
            document.getElementById('scriptStatus').innerHTML = '<strong>脚本已加载</strong><br>变量修正功能可用';
            document.getElementById('scriptStatus').className = 'status success';
          } else {
            document.getElementById('scriptStatus').innerHTML = '<strong>脚本未加载</strong><br>请检查脚本是否正确加载';
            document.getElementById('scriptStatus').className = 'status error';
          }
        }, 1000);
      });

      // 基本操作函数
      function saveOriginalData() {
        if (window.variableCorrection) {
          window.variableCorrection.saveOriginalStatData();
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function correctDisplayData() {
        if (window.variableCorrection) {
          window.variableCorrection.correctDisplayData();
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function resetData() {
        if (window.variableCorrection) {
          window.variableCorrection.resetOriginalData();
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function getStats() {
        if (window.variableCorrection) {
          const stats = window.variableCorrection.getCorrectionStats();
          const statsOutput = document.getElementById('statsOutput');
          statsOutput.innerHTML = '<pre>' + JSON.stringify(stats, null, 2) + '</pre>';
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      // 测试功能
      function testVariableModification() {
        if (window.variableCorrection) {
          const isModified = window.variableCorrection.isVariableModified('test.path', 50);
          addToLog(`测试变量修改检测: test.path = 50, 是否被修改: ${isModified}`);
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function simulateMessageSending() {
        if (window.variableCorrection) {
          // 模拟消息发送事件
          if (typeof eventEmit === 'function') {
            eventEmit('message_sending');
          } else {
            addToLog('模拟消息发送事件');
          }
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function simulateMessageReceived() {
        if (window.variableCorrection) {
          // 模拟消息接收事件
          if (typeof eventEmit === 'function') {
            eventEmit('message_received');
          } else {
            addToLog('模拟消息接收事件');
          }
        } else {
          addToLog('脚本未加载', 'error');
        }
      }

      function clearLog() {
        document.getElementById('logOutput').innerHTML = '';
      }
    </script>
  </body>
</html>
