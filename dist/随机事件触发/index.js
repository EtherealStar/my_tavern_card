var __webpack_modules__ = {
  "./src/shared/constants.ts": 
  /*!*********************************!*\
  !*** ./src/shared/constants.ts ***!
  \*********************************/ (__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RANDOM_EVENT_PATH: () => (/* binding */ RANDOM_EVENT_PATH),\n/* harmony export */   TRIGGERED_RANDOM_EVENTS_PATH: () => (/* binding */ TRIGGERED_RANDOM_EVENTS_PATH),\n/* harmony export */   updateUserKey: () => (/* binding */ updateUserKey),\n/* harmony export */   userKey: () => (/* binding */ userKey)\n/* harmony export */ });\nconst RANDOM_EVENT_PATH = 'stat_data.世界.随机事件[0]';\n/**\n * 获取用户键名，支持多种回退机制\n */\nfunction getUserKey() {\n    try {\n        // 尝试使用 substitudeMacros 函数\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        if (typeof substitudeMacros === 'function') {\n            const result = substitudeMacros('<user>');\n            if (result && result !== '<user>' && typeof result === 'string') {\n                console.log('[Constants] 使用 substitudeMacros 获取用户键:', result);\n                return result;\n            }\n        }\n        // 回退1: 尝试从酒馆助手变量获取\n        if (typeof window.getVariables === 'function') {\n            const vars = window.getVariables({ type: 'global' });\n            const userName = vars?.user_name || vars?.username;\n            if (userName && typeof userName === 'string') {\n                console.log('[Constants] 从全局变量获取用户键:', userName);\n                return userName;\n            }\n        }\n        // 回退2: 尝试从SillyTavern获取\n        const st = window.SillyTavern;\n        if (st?.name1) {\n            console.log('[Constants] 从SillyTavern获取用户键:', st.name1);\n            return st.name1;\n        }\n        // 回退3: 从聊天消息中推断用户名\n        if (typeof window.getChatMessages === 'function') {\n            try {\n                const messages = window.getChatMessages();\n                const userMessage = messages.find((msg) => msg.is_user);\n                if (userMessage?.name) {\n                    console.log('[Constants] 从聊天消息推断用户键:', userMessage.name);\n                    return userMessage.name;\n                }\n            }\n            catch {\n                // ignore\n            }\n        }\n        // 最终回退: 使用默认值\n        console.warn('[Constants] 无法获取用户键，使用默认值: <user>');\n        return '<user>';\n    }\n    catch (error) {\n        console.error('[Constants] 获取用户键时发生错误:', error);\n        return '<user>';\n    }\n}\n// 延迟获取用户键，确保在需要时才计算\nlet userKey = '<user>';\n// 提供动态更新用户键的函数\nfunction updateUserKey() {\n    userKey = getUserKey();\n    return userKey;\n}\n// 在模块加载时尝试获取一次\ntry {\n    userKey = getUserKey();\n}\ncatch {\n    // ignore\n}\nconst TRIGGERED_RANDOM_EVENTS_PATH = 'tavern_helper.random_events.triggered';\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxNQUFNLENBQUM7SUFDUCxTQUFTO0FBQ1gsQ0FBQztBQUNNLE1BQU0sNEJBQTRCLEdBQUcsdUNBQXVDLENBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YXZlcm5faGVscGVyX3RlbXBsYXRlLy4vc3JjL3NoYXJlZC9jb25zdGFudHMudHM/Il0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBSQU5ET01fRVZFTlRfUEFUSCA9ICdzdGF0X2RhdGEu5LiW55WMLumaj+acuuS6i+S7tlswXSc7XHJcblxyXG4vKipcclxuICog6I635Y+W55So5oi36ZSu5ZCN77yM5pSv5oyB5aSa56eN5Zue6YCA5py65Yi2XHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRVc2VyS2V5KCk6IHN0cmluZyB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIOWwneivleS9v+eUqCBzdWJzdGl0dWRlTWFjcm9zIOWHveaVsFxyXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9iYW4tdHMtY29tbWVudFxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgaWYgKHR5cGVvZiBzdWJzdGl0dWRlTWFjcm9zID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHN1YnN0aXR1ZGVNYWNyb3MoJzx1c2VyPicpO1xyXG4gICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdCAhPT0gJzx1c2VyPicgJiYgdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnW0NvbnN0YW50c10g5L2/55SoIHN1YnN0aXR1ZGVNYWNyb3Mg6I635Y+W55So5oi36ZSuOicsIHJlc3VsdCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWbnumAgDE6IOWwneivleS7jumFkummhuWKqeaJi+WPmOmHj+iOt+WPllxyXG4gICAgaWYgKHR5cGVvZiAod2luZG93IGFzIGFueSkuZ2V0VmFyaWFibGVzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIGNvbnN0IHZhcnMgPSAod2luZG93IGFzIGFueSkuZ2V0VmFyaWFibGVzKHsgdHlwZTogJ2dsb2JhbCcgfSk7XHJcbiAgICAgIGNvbnN0IHVzZXJOYW1lID0gdmFycz8udXNlcl9uYW1lIHx8IHZhcnM/LnVzZXJuYW1lO1xyXG4gICAgICBpZiAodXNlck5hbWUgJiYgdHlwZW9mIHVzZXJOYW1lID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdbQ29uc3RhbnRzXSDku47lhajlsYDlj5jph4/ojrflj5bnlKjmiLfplK46JywgdXNlck5hbWUpO1xyXG4gICAgICAgIHJldHVybiB1c2VyTmFtZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIOWbnumAgDI6IOWwneivleS7jlNpbGx5VGF2ZXJu6I635Y+WXHJcbiAgICBjb25zdCBzdCA9ICh3aW5kb3cgYXMgYW55KS5TaWxseVRhdmVybjtcclxuICAgIGlmIChzdD8ubmFtZTEpIHtcclxuICAgICAgY29uc29sZS5sb2coJ1tDb25zdGFudHNdIOS7jlNpbGx5VGF2ZXJu6I635Y+W55So5oi36ZSuOicsIHN0Lm5hbWUxKTtcclxuICAgICAgcmV0dXJuIHN0Lm5hbWUxO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIOWbnumAgDM6IOS7juiBiuWkqea2iOaBr+S4reaOqOaWreeUqOaIt+WQjVxyXG4gICAgaWYgKHR5cGVvZiAod2luZG93IGFzIGFueSkuZ2V0Q2hhdE1lc3NhZ2VzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSAod2luZG93IGFzIGFueSkuZ2V0Q2hhdE1lc3NhZ2VzKCk7XHJcbiAgICAgICAgY29uc3QgdXNlck1lc3NhZ2UgPSBtZXNzYWdlcy5maW5kKChtc2c6IGFueSkgPT4gbXNnLmlzX3VzZXIpO1xyXG4gICAgICAgIGlmICh1c2VyTWVzc2FnZT8ubmFtZSkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1tDb25zdGFudHNdIOS7juiBiuWkqea2iOaBr+aOqOaWreeUqOaIt+mUrjonLCB1c2VyTWVzc2FnZS5uYW1lKTtcclxuICAgICAgICAgIHJldHVybiB1c2VyTWVzc2FnZS5uYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCB7XHJcbiAgICAgICAgLy8gaWdub3JlXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyDmnIDnu4jlm57pgIA6IOS9v+eUqOm7mOiupOWAvFxyXG4gICAgY29uc29sZS53YXJuKCdbQ29uc3RhbnRzXSDml6Dms5Xojrflj5bnlKjmiLfplK7vvIzkvb/nlKjpu5jorqTlgLw6IDx1c2VyPicpO1xyXG4gICAgcmV0dXJuICc8dXNlcj4nO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdbQ29uc3RhbnRzXSDojrflj5bnlKjmiLfplK7ml7blj5HnlJ/plJnor686JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuICc8dXNlcj4nO1xyXG4gIH1cclxufVxyXG5cclxuLy8g5bu26L+f6I635Y+W55So5oi36ZSu77yM56Gu5L+d5Zyo6ZyA6KaB5pe25omN6K6h566XXHJcbmV4cG9ydCBsZXQgdXNlcktleSA9ICc8dXNlcj4nO1xyXG5cclxuLy8g5o+Q5L6b5Yqo5oCB5pu05paw55So5oi36ZSu55qE5Ye95pWwXHJcbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVVc2VyS2V5KCk6IHN0cmluZyB7XHJcbiAgdXNlcktleSA9IGdldFVzZXJLZXkoKTtcclxuICByZXR1cm4gdXNlcktleTtcclxufVxyXG5cclxuLy8g5Zyo5qih5Z2X5Yqg6L295pe25bCd6K+V6I635Y+W5LiA5qyhXHJcbnRyeSB7XHJcbiAgdXNlcktleSA9IGdldFVzZXJLZXkoKTtcclxufSBjYXRjaCB7XHJcbiAgLy8gaWdub3JlXHJcbn1cclxuZXhwb3J0IGNvbnN0IFRSSUdHRVJFRF9SQU5ET01fRVZFTlRTX1BBVEggPSAndGF2ZXJuX2hlbHBlci5yYW5kb21fZXZlbnRzLnRyaWdnZXJlZCc7XHJcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/shared/constants.ts\n\n}");
  },
  "./src/随机事件触发/index.ts": 
  /*!*****************************!*\
  !*** ./src/随机事件触发/index.ts ***!
  \*****************************/ (module, __webpack_exports__, __webpack_require__) => {
    eval("{__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _shared_constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../shared/constants */ \"./src/shared/constants.ts\");\n\n// 等待MVU框架初始化\nawait waitGlobalInitialized('Mvu');\n// 事件池定义\nconst EVENT_POOL = [\n    { name: '姐姐的书架', allowedPeriods: ['上午', '下午'], allowedLocations: ['{{user}}的家'] },\n    { name: '不听话的咖啡机', allowedPeriods: ['上午'], allowedLocations: ['{{user}}的家'] },\n    { name: '蔬菜的转移', allowedPeriods: ['上午', '下午'], allowedLocations: ['守护支部'] },\n    { name: '天台的午餐', allowedPeriods: ['上午'], allowedLocations: ['花丘高中'] },\n    { name: '冰雕', allowedPeriods: ['下午'], allowedLocations: ['{{user}}的家'] },\n    { name: '晚高峰电车', allowedPeriods: ['下午'], allowedLocations: ['花丘高中'] },\n    { name: '图书馆的守护', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '出浴意外', allowedPeriods: ['下午', '晚间'], allowedLocations: ['{{user}}的家'] },\n    { name: '特别辅导', allowedPeriods: ['下午', '晚间'], allowedLocations: ['花丘高中'] },\n    { name: '雨天的伞下', allowedPeriods: ['下午', '晚间'], allowedLocations: ['花丘高中'] },\n    { name: '失窃的丝袜', allowedPeriods: ['下午', '晚间'], allowedLocations: ['{{user}}的家'] },\n    { name: '天台的午睡', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '旧伤疤的故事', allowedPeriods: ['下午'], allowedLocations: ['花丘高中'] },\n    { name: '家庭餐厅的紧急补习', allowedPeriods: ['下午', '晚间'] },\n    { name: '食堂的限定布丁争夺战', allowedPeriods: ['上午', '下午'], allowedLocations: ['守护支部'] },\n    { name: '输掉的惩罚', allowedLocations: ['{{user}}的家'] },\n    { name: '特训', allowedPeriods: ['上午', '下午'], allowedLocations: ['守护支部'] },\n    { name: '体育课', allowedPeriods: ['下午'], allowedLocations: ['花丘高中'] },\n    { name: 'VR游戏', allowedPeriods: ['下午', '晚间'] },\n    { name: '大姐头的房间', allowedPeriods: ['下午', '晚间'] },\n    { name: '被弄湿的教科书', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '迷路的小猫', allowedPeriods: ['下午', '晚间'] },\n    { name: '商业街的橱窗', allowedPeriods: ['下午', '晚间'] },\n    { name: '关于过去的噩梦', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '训练室的意外', allowedLocations: ['守护支部'] },\n    { name: '对决', allowedLocations: ['守护支部'] },\n    { name: '购物之旅', allowedPeriods: ['下午', '晚间'] },\n    { name: '更衣室的意外', allowedPeriods: ['下午'], allowedLocations: ['花丘高中'] },\n    { name: '小巷里的邀请', allowedPeriods: ['下午', '晚间'], allowedLocations: ['花丘高中'] },\n    { name: '雨夜的误会', allowedPeriods: ['下午', '晚间'], allowedLocations: ['花丘高中'] },\n    { name: '奢侈品店的插曲', allowedPeriods: ['下午', '晚间'] },\n    { name: '商业街的调戏', allowedPeriods: ['下午', '晚间'] },\n    { name: '迷路的女游客', allowedPeriods: ['上午', '下午'] },\n    { name: '后台突袭', allowedPeriods: ['下午', '晚间'] },\n    { name: '风纪注意', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '美术社的缪斯', allowedPeriods: ['上午', '下午'], allowedLocations: ['花丘高中'] },\n    { name: '夜间呻吟', allowedPeriods: ['晚间'], allowedLocations: ['{{user}}的家'] },\n    { name: '警官的关心', allowedPeriods: ['晚间'] },\n];\n// 工具函数\nfunction normalizeLocation(loc) {\n    return loc.replace(/{{user}}/g, _shared_constants__WEBPACK_IMPORTED_MODULE_0__.userKey);\n}\nfunction getCurrentPeriod(variables) {\n    return Mvu.getMvuVariable(variables, '世界.时段[0]');\n}\nfunction getCurrentLocation(variables) {\n    return Mvu.getMvuVariable(variables, `${_shared_constants__WEBPACK_IMPORTED_MODULE_0__.userKey}.地点[0]`);\n}\n// 脚本域配置与状态\nconst RANDOM_EVENT_CONFIG_ROOT = '随机事件触发器.配置';\nconst RANDOM_EVENT_STATE_ROOT = '随机事件触发器.状态';\nfunction getCooldownReplies(scriptVars) {\n    const value = _.get(scriptVars, `${RANDOM_EVENT_CONFIG_ROOT}.冷却回复数`, 1);\n    return typeof value === 'number' && value >= 0 ? value : 1;\n}\n/**\n * 确保好感事件优先、且保证写入持久化：\n * - 直接在事件回调中修改传入的 variables，并置 out_is_updated = true，由宿主环境负责持久化；\n * - 若任一角色存在\"待触发\"的好感事件（阶段值为奇数），则本轮放弃随机事件（保证好感事件优先级）；\n * - 若当前\"世界.随机事件\"非\"无\"，放弃随机触发；否则以 45% 概率抽取并写入。\n */\nasync function tryTriggerRandomEvent(variables, _out_is_updated) {\n    try {\n        // 检查是否为0层消息，如果是则不触发随机事件\n        const currentMessageId = getLastMessageId();\n        if (currentMessageId === 0) {\n            return;\n        }\n        // 若存在\"好感事件待触发\"（阶段为奇数），优先让好感事件占用，跳过本次随机触发\n        const affectionStages = Mvu.getMvuVariable(variables, 'tavern_helper.affection_events.stage', {\n            default_value: {},\n        });\n        const hasPendingAffection = affectionStages &&\n            typeof affectionStages === 'object' &&\n            Object.values(affectionStages).some(v => typeof v === 'number' && v > 0 && v % 2 !== 0);\n        if (hasPendingAffection) {\n            return;\n        }\n        const currentEvent = Mvu.getMvuVariable(variables, '世界.随机事件[0]', { default_value: '无' });\n        // 读写脚本域状态（用于避免随机事件连发）：至少间隔一条回复\n        const svars = getVariables({ type: 'script', script_id: getScriptId() });\n        const cooldownTotal = getCooldownReplies(svars);\n        const lastEventName = _.get(svars, `${RANDOM_EVENT_STATE_ROOT}.上次事件名`, '无');\n        let cooldownRemaining = _.get(svars, `${RANDOM_EVENT_STATE_ROOT}.冷却剩余回复数`, 0);\n        let skipThisRound = false;\n        // 若上一轮非“无”，当前为“无”，说明事件刚结束 → 启动冷却\n        if (lastEventName !== '无' && currentEvent === '无') {\n            // 刚结束一条事件：本条回复启用冷却并跳过触发\n            cooldownRemaining = Math.max(0, cooldownTotal - 1);\n            skipThisRound = true;\n        }\n        else if (cooldownRemaining > 0) {\n            // 冷却中：本轮递减并跳过随机事件\n            cooldownRemaining = Math.max(0, cooldownRemaining - 1);\n            skipThisRound = true;\n        }\n        // 更新脚本域状态（记录上次事件名与冷却剩余）\n        _.set(svars, `${RANDOM_EVENT_STATE_ROOT}.上次事件名`, currentEvent);\n        _.set(svars, `${RANDOM_EVENT_STATE_ROOT}.冷却剩余回复数`, cooldownRemaining);\n        await replaceVariables(svars, { type: 'script', script_id: getScriptId() });\n        if (currentEvent !== '无') {\n            // 已被好感事件或其他系统占用，放弃本次随机触发（但仍然已记录 lastEventName）\n            return;\n        }\n        if (skipThisRound) {\n            return;\n        }\n        const currentPeriod = getCurrentPeriod(variables);\n        const currentLocation = getCurrentLocation(variables);\n        if (!currentPeriod || !currentLocation)\n            return;\n        // 获取已触发的事件列表\n        const triggeredEventsPath = _shared_constants__WEBPACK_IMPORTED_MODULE_0__.TRIGGERED_RANDOM_EVENTS_PATH.replace('tavern_helper.', '');\n        const triggeredEvents = Mvu.getMvuVariable(variables, triggeredEventsPath, { default_value: [] });\n        // 事件筛选（兼容未设置限制的事件），并排除已触发的事件\n        const availableEvents = EVENT_POOL.filter(event => {\n            if (triggeredEvents.includes(event.name)) {\n                return false; // 排除已触发的事件\n            }\n            const periodOk = !event.allowedPeriods || event.allowedPeriods.includes(currentPeriod);\n            const locationOk = !event.allowedLocations || event.allowedLocations.map(normalizeLocation).includes(currentLocation);\n            return periodOk && locationOk;\n        });\n        if (availableEvents.length === 0)\n            return;\n        // 45% 概率触发\n        const probability = 0.45;\n        if (Math.random() >= probability)\n            return;\n        // 随机选择一个事件\n        const idx = Math.floor(Math.random() * availableEvents.length);\n        const selectedEvent = availableEvents[idx];\n        // 在事件回调中直接修改传入的 variables，由宿主在回调结束时统一持久化\n        const existedTriggered = Mvu.getMvuVariable(variables, triggeredEventsPath, { default_value: [] });\n        await Mvu.setMvuVariable(variables, '世界.随机事件[0]', selectedEvent.name, { reason: '随机事件触发' });\n        const newTriggered = _.uniq([...(Array.isArray(existedTriggered) ? existedTriggered : []), selectedEvent.name]);\n        await Mvu.setMvuVariable(variables, triggeredEventsPath, newTriggered, { reason: '添加已触发事件' });\n        // 标记已更新，交由宿主持久化\n        _out_is_updated = true;\n        // 事件已开始：将脚本域的上次事件名更新为本次选中事件，避免事件结束时无法识别“刚结束”\n        const svarsAfter = getVariables({ type: 'script', script_id: getScriptId() });\n        _.set(svarsAfter, `${RANDOM_EVENT_STATE_ROOT}.上次事件名`, selectedEvent.name);\n        await replaceVariables(svarsAfter, { type: 'script', script_id: getScriptId() });\n    }\n    catch (error) {\n        console.error('[随机事件触发器] 出错:', error);\n    }\n}\n// 监听变量更新完成钩子\neventOn(Mvu.events.VARIABLE_UPDATE_ENDED, tryTriggerRandomEvent);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } }, 1);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUMsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2hILE1BQU0sR0FBRyxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsbUJBQW1CLEVBQUUsWUFBWSxFQUFFLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUM7UUFDOUYsZ0JBQWdCO1FBQ2hCLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFFdkIsNkNBQTZDO1FBQzdDLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUM5RSxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxHQUFHLHVCQUF1QixRQUFRLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFFLE1BQU0sZ0JBQWdCLENBQUMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ25GLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDeEMsQ0FBQztBQUNILENBQUM7QUFFRCxhQUFhO0FBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMscUJBQXFCLEVBQUUscUJBQXFCLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3RhdmVybl9oZWxwZXJfdGVtcGxhdGUvLi9zcmMv6ZqP5py65LqL5Lu26Kem5Y+RL2luZGV4LnRzPyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUUklHR0VSRURfUkFORE9NX0VWRU5UU19QQVRILCB1c2VyS2V5IH0gZnJvbSAnLi4vc2hhcmVkL2NvbnN0YW50cyc7XG5cbi8vIOetieW+hU1WVeahhuaetuWIneWni+WMllxuYXdhaXQgd2FpdEdsb2JhbEluaXRpYWxpemVkKCdNdnUnKTtcblxudHlwZSBFdmVudEl0ZW0gPSB7XG4gIG5hbWU6IHN0cmluZztcbiAgYWxsb3dlZFBlcmlvZHM/OiBzdHJpbmdbXTtcbiAgYWxsb3dlZExvY2F0aW9ucz86IHN0cmluZ1tdO1xufTtcblxuLy8g5LqL5Lu25rGg5a6a5LmJXG5jb25zdCBFVkVOVF9QT09MOiBFdmVudEl0ZW1bXSA9IFtcbiAgeyBuYW1lOiAn5aeQ5aeQ55qE5Lmm5p62JywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJywgJ+S4i+WNiCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ3t7dXNlcn1955qE5a62J10gfSxcbiAgeyBuYW1lOiAn5LiN5ZCs6K+d55qE5ZKW5ZWh5py6JywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsne3t1c2VyfX3nmoTlrrYnXSB9LFxuICB7IG5hbWU6ICfolKzoj5znmoTovaznp7snLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn5a6I5oqk5pSv6YOoJ10gfSxcbiAgeyBuYW1lOiAn5aSp5Y+w55qE5Y2I6aSQJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn5Yaw6ZuVJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsne3t1c2VyfX3nmoTlrrYnXSB9LFxuICB7IG5hbWU6ICfmmZrpq5jls7DnlLXovaYnLCBhbGxvd2VkUGVyaW9kczogWyfkuIvljYgnXSwgYWxsb3dlZExvY2F0aW9uczogWyfoirHkuJjpq5jkuK0nXSB9LFxuICB7IG5hbWU6ICflm77kuabppobnmoTlrojmiqQnLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn5Ye65rW05oSP5aSWJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ3t7dXNlcn1955qE5a62J10gfSxcbiAgeyBuYW1lOiAn54m55Yir6L6F5a+8JywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+iKseS4mOmrmOS4rSddIH0sXG4gIHsgbmFtZTogJ+mbqOWkqeeahOS8nuS4iycsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSwgYWxsb3dlZExvY2F0aW9uczogWyfoirHkuJjpq5jkuK0nXSB9LFxuICB7IG5hbWU6ICflpLHnqoPnmoTkuJ3oopwnLCBhbGxvd2VkUGVyaW9kczogWyfkuIvljYgnLCAn5pma6Ze0J10sIGFsbG93ZWRMb2NhdGlvbnM6IFsne3t1c2VyfX3nmoTlrrYnXSB9LFxuICB7IG5hbWU6ICflpKnlj7DnmoTljYjnnaEnLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn5pen5Lyk55ak55qE5pWF5LqLJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn5a625bqt6aSQ5Y6F55qE57Sn5oCl6KGl5LmgJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddIH0sXG4gIHsgbmFtZTogJ+mjn+WggueahOmZkOWumuW4g+S4geS6ieWkuuaImCcsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4iuWNiCcsICfkuIvljYgnXSwgYWxsb3dlZExvY2F0aW9uczogWyflrojmiqTmlK/pg6gnXSB9LFxuICB7IG5hbWU6ICfovpPmjonnmoTmg6nnvZonLCBhbGxvd2VkTG9jYXRpb25zOiBbJ3t7dXNlcn1955qE5a62J10gfSxcbiAgeyBuYW1lOiAn54m56K6tJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJywgJ+S4i+WNiCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+WuiOaKpOaUr+mDqCddIH0sXG4gIHsgbmFtZTogJ+S9k+iCsuivvicsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+iKseS4mOmrmOS4rSddIH0sXG4gIHsgbmFtZTogJ1ZS5ri45oiPJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddIH0sXG4gIHsgbmFtZTogJ+Wkp+WnkOWktOeahOaIv+mXtCcsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSB9LFxuICB7IG5hbWU6ICfooqvlvITmub/nmoTmlZnnp5HkuaYnLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn6L+36Lev55qE5bCP54yrJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddIH0sXG4gIHsgbmFtZTogJ+WVhuS4muihl+eahOapseeqlycsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSB9LFxuICB7IG5hbWU6ICflhbPkuo7ov4fljrvnmoTlmanmoqYnLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn6K6t57uD5a6k55qE5oSP5aSWJywgYWxsb3dlZExvY2F0aW9uczogWyflrojmiqTmlK/pg6gnXSB9LFxuICB7IG5hbWU6ICflr7nlhrMnLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+WuiOaKpOaUr+mDqCddIH0sXG4gIHsgbmFtZTogJ+i0reeJqeS5i+aXhScsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSB9LFxuICB7IG5hbWU6ICfmm7TooaPlrqTnmoTmhI/lpJYnLCBhbGxvd2VkUGVyaW9kczogWyfkuIvljYgnXSwgYWxsb3dlZExvY2F0aW9uczogWyfoirHkuJjpq5jkuK0nXSB9LFxuICB7IG5hbWU6ICflsI/lt7fph4znmoTpgoDor7cnLCBhbGxvd2VkUGVyaW9kczogWyfkuIvljYgnLCAn5pma6Ze0J10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn6Zuo5aSc55qE6K+v5LyaJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiL5Y2IJywgJ+aZmumXtCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+iKseS4mOmrmOS4rSddIH0sXG4gIHsgbmFtZTogJ+WlouS+iOWTgeW6l+eahOaPkuabsicsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSB9LFxuICB7IG5hbWU6ICfllYbkuJrooZfnmoTosIPmiI8nLCBhbGxvd2VkUGVyaW9kczogWyfkuIvljYgnLCAn5pma6Ze0J10gfSxcbiAgeyBuYW1lOiAn6L+36Lev55qE5aWz5ri45a6iJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJywgJ+S4i+WNiCddIH0sXG4gIHsgbmFtZTogJ+WQjuWPsOeqgeiirScsIGFsbG93ZWRQZXJpb2RzOiBbJ+S4i+WNiCcsICfmmZrpl7QnXSB9LFxuICB7IG5hbWU6ICfpo47nuqrms6jmhI8nLCBhbGxvd2VkUGVyaW9kczogWyfkuIrljYgnLCAn5LiL5Y2IJ10sIGFsbG93ZWRMb2NhdGlvbnM6IFsn6Iqx5LiY6auY5LitJ10gfSxcbiAgeyBuYW1lOiAn576O5pyv56S+55qE57yq5pavJywgYWxsb3dlZFBlcmlvZHM6IFsn5LiK5Y2IJywgJ+S4i+WNiCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ+iKseS4mOmrmOS4rSddIH0sXG4gIHsgbmFtZTogJ+WknOmXtOWRu+WQnycsIGFsbG93ZWRQZXJpb2RzOiBbJ+aZmumXtCddLCBhbGxvd2VkTG9jYXRpb25zOiBbJ3t7dXNlcn1955qE5a62J10gfSxcbiAgeyBuYW1lOiAn6K2m5a6Y55qE5YWz5b+DJywgYWxsb3dlZFBlcmlvZHM6IFsn5pma6Ze0J10gfSxcbl07XG5cbi8vIOW3peWFt+WHveaVsFxuZnVuY3Rpb24gbm9ybWFsaXplTG9jYXRpb24obG9jOiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gbG9jLnJlcGxhY2UoL3t7dXNlcn19L2csIHVzZXJLZXkpO1xufVxuXG5mdW5jdGlvbiBnZXRDdXJyZW50UGVyaW9kKHZhcmlhYmxlczogTXZ1Lk12dURhdGEpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICByZXR1cm4gTXZ1LmdldE12dVZhcmlhYmxlKHZhcmlhYmxlcywgJ+S4lueVjC7ml7bmrrVbMF0nKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q3VycmVudExvY2F0aW9uKHZhcmlhYmxlczogTXZ1Lk12dURhdGEpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICByZXR1cm4gTXZ1LmdldE12dVZhcmlhYmxlKHZhcmlhYmxlcywgYCR7dXNlcktleX0u5Zyw54K5WzBdYCk7XG59XG5cbi8vIOiEmuacrOWfn+mFjee9ruS4jueKtuaAgVxuY29uc3QgUkFORE9NX0VWRU5UX0NPTkZJR19ST09UID0gJ+maj+acuuS6i+S7tuinpuWPkeWZqC7phY3nva4nO1xuY29uc3QgUkFORE9NX0VWRU5UX1NUQVRFX1JPT1QgPSAn6ZqP5py65LqL5Lu26Kem5Y+R5ZmoLueKtuaAgSc7XG5cbmZ1bmN0aW9uIGdldENvb2xkb3duUmVwbGllcyhzY3JpcHRWYXJzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogbnVtYmVyIHtcbiAgY29uc3QgdmFsdWUgPSBfLmdldChzY3JpcHRWYXJzLCBgJHtSQU5ET01fRVZFTlRfQ09ORklHX1JPT1R9LuWGt+WNtOWbnuWkjeaVsGAsIDEpO1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB2YWx1ZSA+PSAwID8gdmFsdWUgOiAxO1xufVxuXG4vKipcbiAqIOehruS/neWlveaEn+S6i+S7tuS8mOWFiOOAgeS4lOS/neivgeWGmeWFpeaMgeS5heWMlu+8mlxuICogLSDnm7TmjqXlnKjkuovku7blm57osIPkuK3kv67mlLnkvKDlhaXnmoQgdmFyaWFibGVz77yM5bm2572uIG91dF9pc191cGRhdGVkID0gdHJ1Ze+8jOeUseWuv+S4u+eOr+Wig+i0n+i0o+aMgeS5heWMlu+8m1xuICogLSDoi6Xku7vkuIDop5LoibLlrZjlnKhcIuW+heinpuWPkVwi55qE5aW95oSf5LqL5Lu277yI6Zi25q615YC85Li65aWH5pWw77yJ77yM5YiZ5pys6L2u5pS+5byD6ZqP5py65LqL5Lu277yI5L+d6K+B5aW95oSf5LqL5Lu25LyY5YWI57qn77yJ77ybXG4gKiAtIOiLpeW9k+WJjVwi5LiW55WMLumaj+acuuS6i+S7tlwi6Z2eXCLml6BcIu+8jOaUvuW8g+maj+acuuinpuWPke+8m+WQpuWImeS7pSA0NSUg5qaC546H5oq95Y+W5bm25YaZ5YWl44CCXG4gKi9cblxuYXN5bmMgZnVuY3Rpb24gdHJ5VHJpZ2dlclJhbmRvbUV2ZW50KHZhcmlhYmxlczogTXZ1Lk12dURhdGEsIF9vdXRfaXNfdXBkYXRlZD86IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgdHJ5IHtcbiAgICAvLyDmo4Dmn6XmmK/lkKbkuLow5bGC5raI5oGv77yM5aaC5p6c5piv5YiZ5LiN6Kem5Y+R6ZqP5py65LqL5Lu2XG4gICAgY29uc3QgY3VycmVudE1lc3NhZ2VJZCA9IGdldExhc3RNZXNzYWdlSWQoKTtcbiAgICBpZiAoY3VycmVudE1lc3NhZ2VJZCA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIOiLpeWtmOWcqFwi5aW95oSf5LqL5Lu25b6F6Kem5Y+RXCLvvIjpmLbmrrXkuLrlpYfmlbDvvInvvIzkvJjlhYjorqnlpb3mhJ/kuovku7bljaDnlKjvvIzot7Pov4fmnKzmrKHpmo/mnLrop6blj5FcbiAgICBjb25zdCBhZmZlY3Rpb25TdGFnZXMgPSBNdnUuZ2V0TXZ1VmFyaWFibGUodmFyaWFibGVzLCAndGF2ZXJuX2hlbHBlci5hZmZlY3Rpb25fZXZlbnRzLnN0YWdlJywge1xuICAgICAgZGVmYXVsdF92YWx1ZToge30sXG4gICAgfSk7XG4gICAgY29uc3QgaGFzUGVuZGluZ0FmZmVjdGlvbiA9XG4gICAgICBhZmZlY3Rpb25TdGFnZXMgJiZcbiAgICAgIHR5cGVvZiBhZmZlY3Rpb25TdGFnZXMgPT09ICdvYmplY3QnICYmXG4gICAgICBPYmplY3QudmFsdWVzKGFmZmVjdGlvblN0YWdlcykuc29tZSh2ID0+IHR5cGVvZiB2ID09PSAnbnVtYmVyJyAmJiB2ID4gMCAmJiB2ICUgMiAhPT0gMCk7XG4gICAgaWYgKGhhc1BlbmRpbmdBZmZlY3Rpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBjdXJyZW50RXZlbnQgPSBNdnUuZ2V0TXZ1VmFyaWFibGUodmFyaWFibGVzLCAn5LiW55WMLumaj+acuuS6i+S7tlswXScsIHsgZGVmYXVsdF92YWx1ZTogJ+aXoCcgfSk7XG5cbiAgICAvLyDor7vlhpnohJrmnKzln5/nirbmgIHvvIjnlKjkuo7pgb/lhY3pmo/mnLrkuovku7bov57lj5HvvInvvJroh7PlsJHpl7TpmpTkuIDmnaHlm57lpI1cbiAgICBjb25zdCBzdmFycyA9IGdldFZhcmlhYmxlcyh7IHR5cGU6ICdzY3JpcHQnLCBzY3JpcHRfaWQ6IGdldFNjcmlwdElkKCkgfSk7XG4gICAgY29uc3QgY29vbGRvd25Ub3RhbCA9IGdldENvb2xkb3duUmVwbGllcyhzdmFycyk7XG4gICAgY29uc3QgbGFzdEV2ZW50TmFtZTogc3RyaW5nID0gXy5nZXQoc3ZhcnMsIGAke1JBTkRPTV9FVkVOVF9TVEFURV9ST09UfS7kuIrmrKHkuovku7blkI1gLCAn5pegJyk7XG4gICAgbGV0IGNvb2xkb3duUmVtYWluaW5nOiBudW1iZXIgPSBfLmdldChzdmFycywgYCR7UkFORE9NX0VWRU5UX1NUQVRFX1JPT1R9LuWGt+WNtOWJqeS9meWbnuWkjeaVsGAsIDApO1xuXG4gICAgbGV0IHNraXBUaGlzUm91bmQgPSBmYWxzZTtcbiAgICAvLyDoi6XkuIrkuIDova7pnZ7igJzml6DigJ3vvIzlvZPliY3kuLrigJzml6DigJ3vvIzor7TmmI7kuovku7bliJrnu5PmnZ8g4oaSIOWQr+WKqOWGt+WNtFxuICAgIGlmIChsYXN0RXZlbnROYW1lICE9PSAn5pegJyAmJiBjdXJyZW50RXZlbnQgPT09ICfml6AnKSB7XG4gICAgICAvLyDliJrnu5PmnZ/kuIDmnaHkuovku7bvvJrmnKzmnaHlm57lpI3lkK/nlKjlhrfljbTlubbot7Pov4fop6blj5FcbiAgICAgIGNvb2xkb3duUmVtYWluaW5nID0gTWF0aC5tYXgoMCwgY29vbGRvd25Ub3RhbCAtIDEpO1xuICAgICAgc2tpcFRoaXNSb3VuZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChjb29sZG93blJlbWFpbmluZyA+IDApIHtcbiAgICAgIC8vIOWGt+WNtOS4re+8muacrOi9rumAkuWHj+W5tui3s+i/h+maj+acuuS6i+S7tlxuICAgICAgY29vbGRvd25SZW1haW5pbmcgPSBNYXRoLm1heCgwLCBjb29sZG93blJlbWFpbmluZyAtIDEpO1xuICAgICAgc2tpcFRoaXNSb3VuZCA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8g5pu05paw6ISa5pys5Z+f54q25oCB77yI6K6w5b2V5LiK5qyh5LqL5Lu25ZCN5LiO5Ya35Y205Ymp5L2Z77yJXG4gICAgXy5zZXQoc3ZhcnMsIGAke1JBTkRPTV9FVkVOVF9TVEFURV9ST09UfS7kuIrmrKHkuovku7blkI1gLCBjdXJyZW50RXZlbnQpO1xuICAgIF8uc2V0KHN2YXJzLCBgJHtSQU5ET01fRVZFTlRfU1RBVEVfUk9PVH0u5Ya35Y205Ymp5L2Z5Zue5aSN5pWwYCwgY29vbGRvd25SZW1haW5pbmcpO1xuICAgIGF3YWl0IHJlcGxhY2VWYXJpYWJsZXMoc3ZhcnMsIHsgdHlwZTogJ3NjcmlwdCcsIHNjcmlwdF9pZDogZ2V0U2NyaXB0SWQoKSB9KTtcblxuICAgIGlmIChjdXJyZW50RXZlbnQgIT09ICfml6AnKSB7XG4gICAgICAvLyDlt7Looqvlpb3mhJ/kuovku7bmiJblhbbku5bns7vnu5/ljaDnlKjvvIzmlL7lvIPmnKzmrKHpmo/mnLrop6blj5HvvIjkvYbku43nhLblt7LorrDlvZUgbGFzdEV2ZW50TmFtZe+8iVxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChza2lwVGhpc1JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY3VycmVudFBlcmlvZCA9IGdldEN1cnJlbnRQZXJpb2QodmFyaWFibGVzKTtcbiAgICBjb25zdCBjdXJyZW50TG9jYXRpb24gPSBnZXRDdXJyZW50TG9jYXRpb24odmFyaWFibGVzKTtcbiAgICBpZiAoIWN1cnJlbnRQZXJpb2QgfHwgIWN1cnJlbnRMb2NhdGlvbikgcmV0dXJuO1xuXG4gICAgLy8g6I635Y+W5bey6Kem5Y+R55qE5LqL5Lu25YiX6KGoXG4gICAgY29uc3QgdHJpZ2dlcmVkRXZlbnRzUGF0aCA9IFRSSUdHRVJFRF9SQU5ET01fRVZFTlRTX1BBVEgucmVwbGFjZSgndGF2ZXJuX2hlbHBlci4nLCAnJyk7XG4gICAgY29uc3QgdHJpZ2dlcmVkRXZlbnRzOiBzdHJpbmdbXSA9IE12dS5nZXRNdnVWYXJpYWJsZSh2YXJpYWJsZXMsIHRyaWdnZXJlZEV2ZW50c1BhdGgsIHsgZGVmYXVsdF92YWx1ZTogW10gfSk7XG5cbiAgICAvLyDkuovku7bnrZvpgInvvIjlhbzlrrnmnKrorr7nva7pmZDliLbnmoTkuovku7bvvInvvIzlubbmjpLpmaTlt7Lop6blj5HnmoTkuovku7ZcbiAgICBjb25zdCBhdmFpbGFibGVFdmVudHMgPSBFVkVOVF9QT09MLmZpbHRlcihldmVudCA9PiB7XG4gICAgICBpZiAodHJpZ2dlcmVkRXZlbnRzLmluY2x1ZGVzKGV2ZW50Lm5hbWUpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTsgLy8g5o6S6Zmk5bey6Kem5Y+R55qE5LqL5Lu2XG4gICAgICB9XG4gICAgICBjb25zdCBwZXJpb2RPayA9ICFldmVudC5hbGxvd2VkUGVyaW9kcyB8fCBldmVudC5hbGxvd2VkUGVyaW9kcy5pbmNsdWRlcyhjdXJyZW50UGVyaW9kKTtcbiAgICAgIGNvbnN0IGxvY2F0aW9uT2sgPVxuICAgICAgICAhZXZlbnQuYWxsb3dlZExvY2F0aW9ucyB8fCBldmVudC5hbGxvd2VkTG9jYXRpb25zLm1hcChub3JtYWxpemVMb2NhdGlvbikuaW5jbHVkZXMoY3VycmVudExvY2F0aW9uKTtcbiAgICAgIHJldHVybiBwZXJpb2RPayAmJiBsb2NhdGlvbk9rO1xuICAgIH0pO1xuXG4gICAgaWYgKGF2YWlsYWJsZUV2ZW50cy5sZW5ndGggPT09IDApIHJldHVybjtcblxuICAgIC8vIDQ1JSDmpoLnjofop6blj5FcbiAgICBjb25zdCBwcm9iYWJpbGl0eSA9IDAuNDU7XG4gICAgaWYgKE1hdGgucmFuZG9tKCkgPj0gcHJvYmFiaWxpdHkpIHJldHVybjtcblxuICAgIC8vIOmaj+acuumAieaLqeS4gOS4quS6i+S7tlxuICAgIGNvbnN0IGlkeCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGF2YWlsYWJsZUV2ZW50cy5sZW5ndGgpO1xuICAgIGNvbnN0IHNlbGVjdGVkRXZlbnQgPSBhdmFpbGFibGVFdmVudHNbaWR4XTtcblxuICAgIC8vIOWcqOS6i+S7tuWbnuiwg+S4reebtOaOpeS/ruaUueS8oOWFpeeahCB2YXJpYWJsZXPvvIznlLHlrr/kuLvlnKjlm57osIPnu5PmnZ/ml7bnu5/kuIDmjIHkuYXljJZcbiAgICBjb25zdCBleGlzdGVkVHJpZ2dlcmVkOiBzdHJpbmdbXSA9IE12dS5nZXRNdnVWYXJpYWJsZSh2YXJpYWJsZXMsIHRyaWdnZXJlZEV2ZW50c1BhdGgsIHsgZGVmYXVsdF92YWx1ZTogW10gfSk7XG4gICAgYXdhaXQgTXZ1LnNldE12dVZhcmlhYmxlKHZhcmlhYmxlcywgJ+S4lueVjC7pmo/mnLrkuovku7ZbMF0nLCBzZWxlY3RlZEV2ZW50Lm5hbWUsIHsgcmVhc29uOiAn6ZqP5py65LqL5Lu26Kem5Y+RJyB9KTtcbiAgICBjb25zdCBuZXdUcmlnZ2VyZWQgPSBfLnVuaXEoWy4uLihBcnJheS5pc0FycmF5KGV4aXN0ZWRUcmlnZ2VyZWQpID8gZXhpc3RlZFRyaWdnZXJlZCA6IFtdKSwgc2VsZWN0ZWRFdmVudC5uYW1lXSk7XG4gICAgYXdhaXQgTXZ1LnNldE12dVZhcmlhYmxlKHZhcmlhYmxlcywgdHJpZ2dlcmVkRXZlbnRzUGF0aCwgbmV3VHJpZ2dlcmVkLCB7IHJlYXNvbjogJ+a3u+WKoOW3suinpuWPkeS6i+S7ticgfSk7XG4gICAgLy8g5qCH6K6w5bey5pu05paw77yM5Lqk55Sx5a6/5Li75oyB5LmF5YyWXG4gICAgX291dF9pc191cGRhdGVkID0gdHJ1ZTtcblxuICAgIC8vIOS6i+S7tuW3suW8gOWni++8muWwhuiEmuacrOWfn+eahOS4iuasoeS6i+S7tuWQjeabtOaWsOS4uuacrOasoemAieS4reS6i+S7tu+8jOmBv+WFjeS6i+S7tue7k+adn+aXtuaXoOazleivhuWIq+KAnOWImue7k+adn+KAnVxuICAgIGNvbnN0IHN2YXJzQWZ0ZXIgPSBnZXRWYXJpYWJsZXMoeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0pO1xuICAgIF8uc2V0KHN2YXJzQWZ0ZXIsIGAke1JBTkRPTV9FVkVOVF9TVEFURV9ST09UfS7kuIrmrKHkuovku7blkI1gLCBzZWxlY3RlZEV2ZW50Lm5hbWUpO1xuICAgIGF3YWl0IHJlcGxhY2VWYXJpYWJsZXMoc3ZhcnNBZnRlciwgeyB0eXBlOiAnc2NyaXB0Jywgc2NyaXB0X2lkOiBnZXRTY3JpcHRJZCgpIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1vpmo/mnLrkuovku7bop6blj5HlmahdIOWHuumUmTonLCBlcnJvcik7XG4gIH1cbn1cblxuLy8g55uR5ZCs5Y+Y6YeP5pu05paw5a6M5oiQ6ZKp5a2QXG5ldmVudE9uKE12dS5ldmVudHMuVkFSSUFCTEVfVVBEQVRFX0VOREVELCB0cnlUcmlnZ2VyUmFuZG9tRXZlbnQpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/随机事件触发/index.ts\n\n}");
  }
};

var __webpack_module_cache__ = {};

function __webpack_require__(moduleId) {
  var cachedModule = __webpack_module_cache__[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = __webpack_module_cache__[moduleId] = {
    exports: {}
  };
  __webpack_modules__[moduleId](module, module.exports, __webpack_require__);
  return module.exports;
}

(() => {
  var hasSymbol = typeof Symbol === "function";
  var webpackQueues = hasSymbol ? Symbol("webpack queues") : "__webpack_queues__";
  var webpackExports = hasSymbol ? Symbol("webpack exports") : "__webpack_exports__";
  var webpackError = hasSymbol ? Symbol("webpack error") : "__webpack_error__";
  var resolveQueue = queue => {
    if (queue && queue.d < 1) {
      queue.d = 1;
      queue.forEach(fn => fn.r--);
      queue.forEach(fn => fn.r-- ? fn.r++ : fn());
    }
  };
  var wrapDeps = deps => deps.map(dep => {
    if (dep !== null && typeof dep === "object") {
      if (dep[webpackQueues]) return dep;
      if (dep.then) {
        var queue = [];
        queue.d = 0;
        dep.then(r => {
          obj[webpackExports] = r;
          resolveQueue(queue);
        }, e => {
          obj[webpackError] = e;
          resolveQueue(queue);
        });
        var obj = {};
        obj[webpackQueues] = fn => fn(queue);
        return obj;
      }
    }
    var ret = {};
    ret[webpackQueues] = x => {};
    ret[webpackExports] = dep;
    return ret;
  });
  __webpack_require__.a = (module, body, hasAwait) => {
    var queue;
    hasAwait && ((queue = []).d = -1);
    var depQueues = new Set;
    var exports = module.exports;
    var currentDeps;
    var outerResolve;
    var reject;
    var promise = new Promise((resolve, rej) => {
      reject = rej;
      outerResolve = resolve;
    });
    promise[webpackExports] = exports;
    promise[webpackQueues] = fn => (queue && fn(queue), depQueues.forEach(fn), promise["catch"](x => {}));
    module.exports = promise;
    var handle = deps => {
      currentDeps = wrapDeps(deps);
      var fn;
      var getResult = () => currentDeps.map(d => {
        if (d[webpackError]) throw d[webpackError];
        return d[webpackExports];
      });
      var promise = new Promise(resolve => {
        fn = () => resolve(getResult);
        fn.r = 0;
        var fnQueue = q => q !== queue && !depQueues.has(q) && (depQueues.add(q), q && !q.d && (fn.r++, 
        q.push(fn)));
        currentDeps.map(dep => dep[webpackQueues](fnQueue));
      });
      return fn.r ? promise : getResult();
    };
    var done = err => (err ? reject(promise[webpackError] = err) : outerResolve(exports), 
    resolveQueue(queue));
    body(handle, done);
    queue && queue.d < 0 && (queue.d = 0);
  };
})();

(() => {
  __webpack_require__.d = (exports, definition) => {
    for (var key in definition) {
      if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
        Object.defineProperty(exports, key, {
          enumerable: true,
          get: definition[key]
        });
      }
    }
  };
})();

(() => {
  __webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
})();

(() => {
  __webpack_require__.r = exports => {
    if (typeof Symbol !== "undefined" && Symbol.toStringTag) {
      Object.defineProperty(exports, Symbol.toStringTag, {
        value: "Module"
      });
    }
    Object.defineProperty(exports, "__esModule", {
      value: true
    });
  };
})();

var __webpack_exports__ = __webpack_require__("./src/随机事件触发/index.ts");

__webpack_exports__ = await __webpack_exports__;